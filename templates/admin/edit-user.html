<!DOCTYPE html>
<html lang="en">

<!-- Mirrored from hotflix.volkovdesign.com/admin/edit-user.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 01 Oct 2024 14:35:46 GMT -->
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<!-- CSS -->
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="css/slimselect.css">
	<link rel="stylesheet" href="css/admin.css">

	<!-- Icon font -->
	<link rel="stylesheet" href="webfont/tabler-icons.min.css">

	<!-- Favicons -->
	<link rel="icon" type="image/png" href="icon/favicon-32x32.png" sizes="32x32">
	<link rel="apple-touch-icon" href="icon/favicon-32x32.png">

	<meta name="description" content="Online Movies, TV Shows & Cinema HTML Template">
	<meta name="keywords" content="">
	<meta name="author" content="Dmitry Volkov">
	<title>HotFlix – Online Movies, TV Shows & Cinema HTML Template</title>
</head>

<body>
	<!-- header -->
	<header class="header">
		<div class="header__content">
			<!-- header logo -->
			<a href="index.html" class="header__logo">
				<img src="img/logo.svg" alt="">
			</a>
			<!-- end header logo -->

			<!-- header menu btn -->
			<button class="header__btn" type="button">
				<span></span>
				<span></span>
				<span></span>
			</button>
			<!-- end header menu btn -->
		</div>
	</header>
	<!-- end header -->

	<!-- sidebar -->
	<div class="sidebar">
		<!-- sidebar logo -->
		<a href="index.html" class="sidebar__logo">
			<img src="img/logo.svg" alt="">
		</a>
		<!-- end sidebar logo -->
		
		<!-- sidebar user -->
		<div class="sidebar__user">
			<div class="sidebar__user-img">
				<img src="img/user.svg" alt="">
			</div>

			<div class="sidebar__user-title">
				<span>Admin</span>
				<p>John Doe</p>
			</div>

			<button class="sidebar__user-btn" type="button">
				<i class="ti ti-logout"></i>
			</button>
		</div>
		<!-- end sidebar user -->

		<!-- sidebar nav -->
		<div class="sidebar__nav-wrap">
			<ul class="sidebar__nav">
				<li class="sidebar__nav-item">
					<a href="index.html" class="sidebar__nav-link"><i class="ti ti-layout-grid"></i> <span>Dashboard</span></a>
				</li>

				<li class="sidebar__nav-item">
					<a href="catalog.html" class="sidebar__nav-link"><i class="ti ti-movie"></i> <span>Catalog</span></a>
				</li>

				<li class="sidebar__nav-item">
					<a href="users.html" class="sidebar__nav-link"><i class="ti ti-users"></i> <span>Users</span></a>
				</li>

				<li class="sidebar__nav-item">
					<a href="comments.html" class="sidebar__nav-link"><i class="ti ti-message"></i> <span>Comments</span></a>
				</li>

				<li class="sidebar__nav-item">
					<a href="reviews.html" class="sidebar__nav-link"><i class="ti ti-star-half-filled"></i> <span>Reviews</span></a>
				</li>

				<li class="sidebar__nav-item">
					<a href="settings.html" class="sidebar__nav-link"><i class="ti ti-settings"></i> <span>Settings</span></a>
				</li>

				<!-- dropdown -->
				<li class="sidebar__nav-item">
					<a class="sidebar__nav-link" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false"><i class="ti ti-files"></i> <span>Pages</span> <i class="ti ti-chevron-down"></i></a>

					<ul class="dropdown-menu sidebar__dropdown-menu">
						<li><a href="add-item.html">Add item</a></li>
						<li><a href="edit-user.html">Edit user</a></li>
						<li><a href="signin.html">Sign In</a></li>
						<li><a href="signup.html">Sign Up</a></li>
						<li><a href="forgot.html">Forgot password</a></li>
						<li><a href="404.html">404 Page</a></li>
					</ul>
				</li>
				<!-- end dropdown -->

				<li class="sidebar__nav-item">
					<a href="https://hotflix.volkovdesign.com/main/index.html" class="sidebar__nav-link"><i class="ti ti-arrow-left"></i> <span>Back to HotFlix</span></a>
				</li>
			</ul>
		</div>
		<!-- end sidebar nav -->
		
		<!-- sidebar copyright -->
		<div class="sidebar__copyright">© HOTFLIX, 2019—2024. <br>Create by <a href="https://themeforest.net/user/dmitryvolkov/portfolio" target="_blank">Dmitry Volkov</a></div>
		<!-- end sidebar copyright -->
	</div>
	<!-- end sidebar -->

	<!-- main content -->
	<main class="main">
		<div class="container-fluid">
			<div class="row">
				<!-- main title -->
				<div class="col-12">
					<div class="main__title">
						<h2>Edit user</h2>
					</div>
				</div>
				<!-- end main title -->

				<!-- profile -->
				<div class="col-12">
					<div class="profile__content">
						<!-- profile user -->
						<div class="profile__user">
							<div class="profile__avatar">
								<img src="img/user.svg" alt="">
							</div>
							<!-- or red -->
							<div class="profile__meta profile__meta--green">
								<h3 id="h3name">John Doe  </h3>
								<span id="spanid">ID: 23562</span>
								<span id="status-account"></span>
							</div>
						</div>
						<!-- end profile user -->

						<!-- profile tabs nav -->
						<ul class="nav nav-tabs profile__tabs" id="profile__tabs" role="tablist">
							<li class="nav-item" role="presentation">
								<button id="1-tab" class="active" data-bs-toggle="tab" data-bs-target="#tab-1" type="button" role="tab" aria-controls="tab-1" aria-selected="true">Profile</button>
							</li>

							<li class="nav-item" role="presentation">
								<button id="2-tab" data-bs-toggle="tab" data-bs-target="#tab-2" type="button" role="tab" aria-controls="tab-2" aria-selected="false">Comments</button>
							</li>

						</ul>
						<!-- end profile tabs nav -->

						<!-- profile btns -->
						<div class="profile__actions">
							<button type="button" data-bs-toggle="modal" class="profile__action profile__action--banned" data-bs-target="#modal-status3"><i class="ti ti-lock"></i></button>
						</div>
						<!-- end profile btns -->
					</div>
				</div>
				<!-- end profile -->

				<!-- content tabs -->
				<div class="tab-content">
					<div class="tab-pane fade show active" id="tab-1" role="tabpanel" aria-labelledby="1-tab" tabindex="0">
						<div class="col-12">
							<div class="row">
								<!-- details form -->
								<div class="col-12 col-lg-6">
									<form action="#" class="sign__form sign__form--profile">
										<div class="row">
											<div class="col-12">
												<h4 class="sign__title">Profile details</h4>
											</div>

											<div class="col-12 col-md-6">
												<div class="sign__group">
													<label class="sign__label" for="firstName">First Name</label>
													<input id="firstName" type="text" name="firstName" class="sign__input" placeholder="firstName">
												</div>
											</div>

											<div class="col-12 col-md-6">
												<div class="sign__group">
													<label class="sign__label" for="email2">Email</label>
													<input id="email2" type="text" name="email" class="sign__input" placeholder="email@email.com">
												</div>
											</div>

											<div class="col-12 col-md-6">
												<div class="sign__group">
													<label class="sign__label" for="lastName">lastName</label>
													<input id="lastName" type="text" name="lastName" class="sign__input" placeholder="lastName">
												</div>
											</div>

<!--											<div class="col-12 col-md-6">-->
<!--												<div class="sign__group">-->
<!--													<label class="sign__label" for="sign__gallery-upload">Avatar</label>-->
<!--													<div class="sign__gallery">-->
<!--														<label id="gallery1" for="sign__gallery-upload">Upload (40x40)</label>-->
<!--														<input data-name="#gallery1" id="sign__gallery-upload" name="gallery" class="sign__gallery-upload" type="file" accept=".png, .jpg, .jpeg" multiple="">-->
<!--													</div>-->
<!--												</div>-->
<!--											</div>-->

<!--											<div class="col-12 col-md-6">-->
<!--												<div class="sign__group">-->
<!--													<label class="sign__label" for="subscription">Subscription</label>-->
<!--													<select class="sign__select" id="subscription">-->
<!--														<option value="Basic">Basic</option>-->
<!--														<option value="Premium">Premium</option>-->
<!--														<option value="Cinematic">Cinematic</option>-->
<!--													</select>-->
<!--												</div>-->
<!--											</div>-->

											<div class="col-12 col-md-6">
												<div class="sign__group">
													<label class="sign__label" for="rights">Rights</label>
													<select class="sign__select" id="rights">
														<option value="User">User</option>
<!--														<option value="Moderator">Moderator</option>-->
														<option value="Admin">Admin</option>
													</select>
												</div>
											</div>

											<div class="col-12">
												<button class="sign__btn sign__btn--small" type="button" id="changeInfo"><span>Save</span></button>
											</div>
										</div>
									</form>
								</div>
								<!-- end details form -->

								<!-- password form -->
								<div class="col-12 col-lg-6">
									<form action="#" class="sign__form sign__form--profile">
										<div class="row">
											<div class="col-12">
												<h4 class="sign__title">Change password</h4>
											</div>

<!--											<div class="col-12 col-md-6 col-lg-12 col-xxl-6">-->
<!--												<div class="sign__group">-->
<!--													<label class="sign__label" for="oldpass">Old Password</label>-->
<!--													<input id="oldpass" type="password" name="oldpass" class="sign__input">-->
<!--												</div>-->
<!--											</div>-->

											<div class="col-12 col-md-6 col-lg-12 col-xxl-6">
												<div class="sign__group">
													<label class="sign__label" for="newpass">New Password</label>
													<input id="newpass" type="password" name="newpass" class="sign__input">
												</div>
											</div>

											<div class="col-12 col-md-6 col-lg-12 col-xxl-6">
												<div class="sign__group">
													<label class="sign__label" for="confirmpass">Confirm New Password</label>
													<input id="confirmpass" type="password" name="confirmpass" class="sign__input">
												</div>
											</div>

											<div class="col-12">
												<button class="sign__btn sign__btn--small" type="button" id="changePass"><span>Change</span></button>
											</div>
										</div>
									</form>
								</div>
								<!-- end password form -->
							</div>
						</div>
					</div>

					<div class="tab-pane fade" id="tab-2" role="tabpanel" aria-labelledby="2-tab" tabindex="0">
						<!-- table -->
						<div class="col-12">
							<div class="catalog catalog--1">
								<table class="catalog__table">
									<thead>
									<tr>
										<th>ID</th>
										<th>Movie ID</th>
										<th>User ID</th>
										<th>Author</th>
										<th>Text</th>
										<th>Created Date</th>
										<th>Actions</th>
									</tr>
									</thead>
									<tbody>
									<!-- Dữ liệu bình luận sẽ được tải và chèn vào đây bởi JavaScript -->
									</tbody>
								</table>
							</div>

						</div>
						<!-- end table -->

						<!-- paginator -->

						<!-- end paginator -->
					</div>


				</div>
				<!-- end content tabs -->
			</div>
		</div>
	</main>
	<!-- end main content -->

	<!-- view modal -->
	<div class="modal fade" id="modal-view" tabindex="-1" aria-labelledby="modal-view" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal__content modal__content--view">
					<div class="comments__autor">
						<img class="comments__avatar" src="img/user.svg" alt="">
						<span class="comments__name">John Doe</span>
						<span class="comments__time">30.08.2023, 17:53</span>
					</div>
					<p class="comments__text">There are many variations of passages of Lorem Ipsum available, but the majority have suffered alteration in some form, by injected humour, or randomised words which don't look even slightly believable. If you are going to use a passage of Lorem Ipsum, you need to be sure there isn't anything embarrassing hidden in the middle of text.</p>
					<div class="comments__actions">
						<div class="comments__rate">
							<span><i class="ti ti-thumb-up"></i>12</span>

							<span>7<i class="ti ti-thumb-down"></i></span>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end view modal -->

	<!-- delete modal -->
	<div class="modal fade" id="modal-delete" tabindex="-1" aria-labelledby="modal-delete" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal__content">
					<h4 class="modal__title">Confirm Deletion</h4>
					<p class="modal__text">Are you sure you want to delete this comment?</p>
					<div class="modal__btns">
						<button class="modal__btn modal__btn--apply" id="confirmDelete" type="button" data-id=""><span>Delete</span></button>
						<button class="modal__btn modal__btn--dismiss" type="button" data-bs-dismiss="modal" aria-label="Close"><span>Cancel</span></button>
					</div>
				</div>
			</div>
		</div>
	</div>


	<!-- end delete modal -->

	<!-- view modal -->
	<div class="modal fade" id="modal-view2" tabindex="-1" aria-labelledby="modal-view2" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal__content modal__content--view">
					<div class="reviews__autor">
						<img class="reviews__avatar" src="img/user.svg" alt="">
						<span class="reviews__name">Best Marvel movie in my opinion</span>
						<span class="reviews__time">24.08.2018, 17:53 by John Doe</span>

						<span class="reviews__rating reviews__rating--green">8.4</span>
					</div>
					<p class="reviews__text">There are many variations of passages of Lorem Ipsum available, but the majority have suffered alteration in some form, by injected humour, or randomised words which don't look even slightly believable. If you are going to use a passage of Lorem Ipsum, you need to be sure there isn't anything embarrassing hidden in the middle of text.</p>
				</div>
			</div>
		</div>
	</div>
	<!-- end view modal -->

	<!-- delete modal -->
	<div class="modal fade" id="modal-delete2" tabindex="-1" aria-labelledby="modal-delete2" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal__content">
					<form action="#" class="modal__form">
						<h4 class="modal__title">Review delete</h4>

						<p class="modal__text">Are you sure to permanently delete this review?</p>

						<div class="modal__btns">
							<button class="modal__btn modal__btn--apply" type="button"><span>Delete</span></button>
							<button class="modal__btn modal__btn--dismiss" type="button" data-bs-dismiss="modal" aria-label="Close"><span>Dismiss</span></button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
	<!-- end delete modal -->

	<!-- status modal -->
	<div class="modal fade" id="modal-status3" tabindex="-1" aria-labelledby="modal-status3" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal__content">
					<form action="#" class="modal__form">
						<h4 class="modal__title">Status change</h4>

						<p class="modal__text">Are you sure about immediately change status?</p>

						<div class="modal__btns">
							<button id="applyTrash" class="modal__btn modal__btn--apply" type="button"><span>Apply</span></button>
							<button class="modal__btn modal__btn--dismiss" type="button" data-bs-dismiss="modal" aria-label="Close"><span>Dismiss</span></button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
	<!-- end status modal -->
	
	<!-- delete modal -->
	<div class="modal fade" id="modal-delete3" tabindex="-1" aria-labelledby="modal-delete3" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal__content">
					<form action="#" class="modal__form">
						<h4 class="modal__title">User delete</h4>

						<p class="modal__text">Are you sure to permanently delete this user?</p>

						<div class="modal__btns">
							<button class="modal__btn modal__btn--apply" type="button"><span>Delete</span></button>
							<button class="modal__btn modal__btn--dismiss" type="button" data-bs-dismiss="modal" aria-label="Close"><span>Dismiss</span></button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
	<!-- end delete modal -->

	<!-- JS -->
	<script src="js/bootstrap.bundle.min.js"></script>
	<script src="js/slimselect.min.js"></script>
	<script src="js/smooth-scrollbar.js"></script>
	<script src="js/admin.js"></script>
	<script>
		// Hàm lấy userId từ URL
		function getUserIdFromURL() {
			const params = new URLSearchParams(window.location.search);
			return params.get('userId'); // 'userId' là tên param trong URL (vd: /profile.html?userId=1)
		}
		const profileMeta = document.querySelector('#h3name');
		const profileIdSpan = document.querySelector('#spanid');
		const token = localStorage.getItem('token'); // Thay bằng cách lấy token phù hợp

		// Lấy userId từ URL
		const userId = getUserIdFromURL();

		if (!userId) {
			alert('User ID not found in URL.');
		}
		let userDeletedAt;
		// Hàm tải thông tin người dùng
		function loadUserInfo() {
			fetch(`/api/v1/user/${userId}`, {
				method: 'GET',
				headers: {
					'Authorization': `Bearer ${token}` // Thêm token vào header
				}
			})
					.then(response => response.json())
					.then(data => {
						// Không có `data.success`, nên kiểm tra trực tiếp dữ liệu người dùng
						if (data.id) {
							// Hiển thị firstName + lastName và ID
							const fullName = `${data.firstName} ${data.lastName}`;
							const userIdText = `ID: ${data.id}`;
							console.log(fullName, " ", userIdText);
							userDeletedAt = data.deleted_at;
							document.querySelector('#status-account').textContent =data.deleted_at === null ? 'Active' :'Locked';

							// Cập nhật nội dung vào HTML
							document.querySelector('#firstName').value = data.firstName;
							document.querySelector('#lastName').value = data.lastName;
							document.querySelector('#email2').value = data.email;
							document.querySelector('#rights').value = data.role_id === 2 ? 'Admin' : 'User';
							profileMeta.textContent = fullName;
							profileIdSpan.textContent = userIdText;
						} else {
							alert('Error loading user info.');
						}
					})
					.catch(error => {
						console.error('Error:', error);
						alert('An error occurred while loading user info.');
					});
		}

		// Gọi hàm để tải thông tin người dùng
		loadUserInfo();
		// Lấy các phần tử HTML
		const saveProfileButton = document.querySelector('#changeInfo');
		const changePasswordButton = document.querySelector('#changePass');

		// Giả sử bạn đã lưu token vào localStorage sau khi đăng nhập


		// Hàm cập nhật thông tin người dùng
		saveProfileButton.addEventListener('click', () => {
			// Lấy giá trị từ các input
			const firstName = document.querySelector('#firstName').value;
			const lastName = document.querySelector('#lastName').value;
			const email = document.querySelector('#email2').value;
			const rights = document.querySelector('#rights').value;

			// Kiểm tra dữ liệu trước khi gửi
			if (!firstName || !lastName || !email) {
				alert('Please fill out all required fields.');
				return;
			}

			const userInfo = {
				first_name: firstName,
				last_name: lastName,
				email: email,
				role_id: rights === 'Admin' ? 2 : 1
			};

			console.log('Updating user info:', userInfo);

			fetch(`/api/v1/user/${userId}/info`, {
				method: 'PUT',
				headers: {
					'Content-Type': 'application/json',
					'Authorization': `Bearer ${token}` // Đảm bảo token hợp lệ
				},
				body: JSON.stringify(userInfo)
			})
					.then(response => response.json())
					.then(data => {
						console.log('Response from updating profile:', data);
						if (data.message) {
							alert('User info updated successfully!');
						} else if (data.error) {
							alert('Error updating profile: ' + data.error);
						}
					})
					.catch(error => {
						console.error('Error occurred during profile update:', error);
						alert('An error occurred while updating profile.');
					});
		});


		// Hàm thay đổi mật khẩu
		changePasswordButton.addEventListener('click', () => {
			// Lấy giá trị từ các input
			const newPassword = document.querySelector('#newpass').value;
			const confirmPassword = document.querySelector('#confirmpass').value;

			// Kiểm tra nếu mật khẩu không trùng nhau
			if (newPassword !== confirmPassword) {
				alert('New password and confirm password do not match.');
				return;
			}

			// Kiểm tra nếu mật khẩu mới bị bỏ trống
			if (!newPassword || newPassword.trim() === '') {
				alert('Password cannot be empty.');
				return;
			}

			const passwordInfo = {
				password: newPassword
			};

			console.log('Changing password for user with data:', passwordInfo);

			fetch(`/api/v1/user/${userId}/password`, {
				method: 'PUT',
				headers: {
					'Content-Type': 'application/json',
					'Authorization': `Bearer ${token}` // Đảm bảo token hợp lệ
				},
				body: JSON.stringify(passwordInfo)
			})
					.then(response => response.json())
					.then(data => {
						console.log('Response from changing password:', data);
						if (data.message) {
							alert('Password changed successfully!');
						} else if (data.error){
							alert('Error changing password: ' + (data.error || 'Unknown error'));
						}
					})
					.catch(error => {
						console.error('Error occurred during password change:', error);
						alert('An error occurred while changing password.');
					});
		});
		const applyButton = document.querySelector('#applyTrash');
		applyButton.addEventListener('click', () => {
			console.log("Bắt đầu xử lý người dùng:", userId);



			if (!userDeletedAt) { // Nếu deletedAt là nil (người dùng đang bị khóa)
				// Xóa người dùng
				fetch(`/api/v1/user/${userId}`, {
					method: 'DELETE',
					headers: {
						'Authorization': `Bearer ${token}` // Thêm token vào header
					}
				})
						.then(response => {
							if (response.ok) {
								alert('Tài khoản đã được xóa thành công.');
								window.location.reload(); // Chuyển hướng sau khi xóa thành công
							} else {
								return response.json().then(data => {
									alert('Lỗi khi xóa tài khoản: ' + (data.error || 'Có lỗi xảy ra.'));
								});
							}
						})
						.catch(error => {
							console.error('Error:', error);
							alert('Có lỗi xảy ra khi xóa tài khoản.');
						});
			} else { // Nếu deletedAt không phải là nil (người dùng đã bị xóa)
				// Mở khóa người dùng
				fetch(`/api/v1/user/${userId}/unlock`, {
					method: 'PUT',
					headers: {
						'Authorization': `Bearer ${token}` // Thêm token vào header
					}
				})
						.then(response => {
							if (response.ok) {
								alert('Tài khoản đã được mở khóa thành công.');
								window.location.reload(); // Chuyển hướng sau khi mở khóa thành công
							} else {
								return response.json().then(data => {
									alert('Lỗi khi mở khóa tài khoản: ' + (data.error || 'Có lỗi xảy ra.'));
								});
							}
						})
						.catch(error => {
							console.error('Error:', error);
							alert('Có lỗi xảy ra khi mở khóa tài khoản.');
						});
			}
		});
		// Function để tải bình luận của một user và hiển thị chúng trong bảng
		function loadComments(userId) {
			console.log("load cmt",userId)
			fetch(`/api/v1/user/${userId}/comment`, {
				method: 'GET',
				headers: {
					'Authorization': `Bearer ${token}` // Thêm token vào header nếu cần
				}
			})
					.then(response => response.json())
					.then(comments => {
						const tbody = document.querySelector('.catalog__table tbody');
						tbody.innerHTML = ''; // Xóa sạch nội dung hiện tại

						if (!Array.isArray(comments) || comments.length === 0) {
							// Trường hợp không có bình luận
							const noCommentsRow = document.createElement('tr');
							noCommentsRow.innerHTML = `
                <td colspan="7">
                    <div class="catalog__text">User chưa có bình luận nào.</div>
                </td>
            `;
							tbody.appendChild(noCommentsRow);
						} else {
							// Nếu có bình luận thì hiển thị bình luận vào bảng
							comments.forEach(comment => {
								const row = document.createElement('tr');
								row.innerHTML = `
                    <td><div class="catalog__text">${comment.id}</div></td>
                    <td><div class="catalog__text"><a href="#">${comment.movie_id}</a></div></td>
                    <td><div class="catalog__text">${comment.user_id}</div></td>
                    <td><div class="catalog__text">${comment.user_name}</div></td>
                    <td><div class="catalog__text">${comment.content}</div></td>
                    <td><div class="catalog__text">${new Date(comment.created_at).toLocaleDateString()}</div></td>
                    <td>
                        <div class="catalog__btns">
                            <button type="button" class="catalog__btn catalog__btn--delete" data-id="${comment.id}" data-bs-toggle="modal" data-bs-target="#modal-delete">
                                <i class="ti ti-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
								tbody.appendChild(row);
							});

							// Thêm sự kiện click cho các nút xóa
							document.querySelectorAll('.catalog__btn--delete').forEach(button => {
								button.addEventListener('click', (e) => {
									const commentId = e.target.closest('button').dataset.id;
									document.querySelector('#confirmDelete').dataset.id = commentId;
								});
							});
						}
					})
					.catch(error => {
						console.error('Error loading comments:', error);
						alert('Error loading comments');
					});
		}

		// Function để xóa một bình luận
		function deleteComment(commentId) {
			fetch(`/api/v1/comment/${commentId}`, {
				method: 'DELETE',
				headers: {
					'Authorization': `Bearer ${token}` // Thêm token vào header nếu cần
				}
			})
					.then(response => {
						if (response.ok) {
							alert('Comment deleted successfully');
							loadComments(userId); // Tải lại danh sách bình luận sau khi xóa
						} else {
							return response.json().then(data => {
								alert('Error deleting comment: ' + (data.error || 'Unknown error'));
							});
						}
					})
					.catch(error => {
						console.error('Error deleting comment:', error);
						alert('Error deleting comment');
					});
		}

		// Sự kiện click cho nút "Delete" trong modal
		document.querySelector('#confirmDelete').addEventListener('click', () => {
			const commentId = document.querySelector('#confirmDelete').dataset.id;
			deleteComment(commentId);

			// Đóng modal sau khi xóa
			const modal = bootstrap.Modal.getInstance(document.getElementById('modal-delete'));
			modal.hide();
		});

		// Gọi function để tải thông tin bình luận khi trang được load
		document.addEventListener('DOMContentLoaded', () => {
			loadComments(userId); // Gọi hàm này để tải bình luận của user khi trang load
		});


	</script>


</body>

<!-- Mirrored from hotflix.volkovdesign.com/admin/edit-user.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 01 Oct 2024 14:35:46 GMT -->
</html>