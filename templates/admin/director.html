<!DOCTYPE html>
<html lang="en">

<!-- Mirrored from hotflix.volkovdesign.com/admin/comments.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 01 Oct 2024 14:35:45 GMT -->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/slimselect.css">
    <link rel="stylesheet" href="css/admin.css">

    <!-- Icon font -->
    <link rel="stylesheet" href="webfont/tabler-icons.min.css">

    <!-- Favicons -->
    <link rel="icon" type="image/png" href="icon/favicon-32x32.png" sizes="32x32">
    <link rel="apple-touch-icon" href="icon/favicon-32x32.png">

    <meta name="description" content="Online Movies, TV Shows & Cinema HTML Template">
    <meta name="keywords" content="">
    <meta name="author" content="Dmitry Volkov">
    <title>HotFlix – Online Movies, TV Shows & Cinema HTML Template</title>
</head>

<body>
<!-- header -->
<header class="header">
    <div class="header__content">
        <!-- header logo -->
        <a href="index.html" class="header__logo">
            <img src="img/logo.svg" alt="">
        </a>
        <!-- end header logo -->

        <!-- header menu btn -->
        <button class="header__btn" type="button">
            <span></span>
            <span></span>
            <span></span>
        </button>
        <!-- end header menu btn -->
    </div>
</header>
<!-- end header -->

<!-- sidebar -->
<div class="sidebar">
    <!-- sidebar logo -->
    <a href="index.html" class="sidebar__logo">
        <img src="img/logo.svg" alt="">
    </a>
    <!-- end sidebar logo -->

    <!-- sidebar user -->
    <div class="sidebar__user">
        <div class="sidebar__user-img">
            <img src="img/user.svg" alt="">
        </div>

        <div class="sidebar__user-title">
            <span>Admin</span>
        </div>

        <button class="sidebar__user-btn" type="button">
            <i class="ti ti-logout"></i>
        </button>
    </div>
    <!-- end sidebar user -->

    <!-- sidebar nav -->
    <div class="sidebar__nav-wrap">
        <ul class="sidebar__nav">
            <li class="sidebar__nav-item">
                <a href="index.html" class="sidebar__nav-link"><i class="ti ti-layout-grid"></i> <span>Dashboard</span></a>
            </li>

            <li class="sidebar__nav-item">
                <a href="catalog.html" class="sidebar__nav-link"><i class="ti ti-movie"></i> <span>Catalog</span></a>
            </li>

            <li class="sidebar__nav-item">
                <a href="users.html" class="sidebar__nav-link"><i class="ti ti-users"></i> <span>Users</span></a>
            </li>

            <li class="sidebar__nav-item">
                <a href="comments.html" class="sidebar__nav-link sidebar__nav-link--active"><i class="ti ti-message"></i> <span>Comments</span></a>
            </li>

            <li class="sidebar__nav-item">
                <a href="reviews.html" class="sidebar__nav-link"><i class="ti ti-star-half-filled"></i> <span>Reviews</span></a>
            </li>

            <li class="sidebar__nav-item">
                <a href="settings.html" class="sidebar__nav-link"><i class="ti ti-settings"></i> <span>Settings</span></a>
            </li>

            <!-- dropdown -->
            <li class="sidebar__nav-item">
                <a class="sidebar__nav-link" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false"><i class="ti ti-files"></i> <span>Pages</span> <i class="ti ti-chevron-down"></i></a>

                <ul class="dropdown-menu sidebar__dropdown-menu">
                    <li><a href="add-item.html">Add item</a></li>
                    <li><a href="edit-user.html">Edit user</a></li>
                    <li><a href="signin.html">Sign In</a></li>
                    <li><a href="signup.html">Sign Up</a></li>
                    <li><a href="forgot.html">Forgot password</a></li>
                    <li><a href="404.html">404 Page</a></li>
                </ul>
            </li>
            <!-- end dropdown -->

            <li class="sidebar__nav-item">
                <a href="https://hotflix.volkovdesign.com/main/index.html" class="sidebar__nav-link"><i class="ti ti-arrow-left"></i> <span>Back to HotFlix</span></a>
            </li>
        </ul>
    </div>
    <!-- end sidebar nav -->

    <!-- sidebar copyright -->
    <!-- end sidebar copyright -->
</div>
<!-- end sidebar -->

<!-- main content -->
<main class="main">
    <div class="container-fluid">
        <div class="row">
            <!-- main title -->
            <div class="col-12">
                <div class="main__title">

                    <h2>Directors</h2>

                    <span class="main__title-stat"></span>

                    <div class="main__title-wrap">
                        <a href="/admin/add-director" class="main__title-link main__title-link--wrap">Add director</a>
                        <!-- search -->
                        <form action="#" class="main__title-form">
                            <input type="text" placeholder="Key word..">
                            <button type="button">
                                <i class="ti ti-search"></i>
                            </button>
                        </form>
                        <!-- end search -->
                    </div>
                </div>
            </div>
            <!-- end main title -->

            <!-- comments -->
            <div class="col-12">
                <div class="catalog catalog--1">
                    <table class="catalog__table">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Year of birth </th>
                            <th>ACTIONS</th>
                        </tr>
                        </thead>

                        <tbody>



                        </tbody>
                    </table>
                </div>
            </div>
            <!-- end comments -->

            <!-- paginator -->
            <div class="col-12">
                <div class="main__paginator">
                    <!-- amount -->
                    <!-- end amount -->

                    <ul class="main__paginator-list">
                        <li>
                            <a href="#">
                                <i class="ti ti-chevron-left"></i>
                                <span>Prev</span>
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <span>Next</span>
                                <i class="ti ti-chevron-right"></i>
                            </a>
                        </li>
                    </ul>

                    <ul class="paginator">
                        <!-- Sẽ được tạo động bằng JS -->
                    </ul>

                </div>
            </div>
            <!-- end paginator -->
        </div>
    </div>
</main>
<!-- end main content -->



<!-- JS -->
<script src="js/bootstrap.bundle.min.js"></script>
<script src="js/slimselect.min.js"></script>
<script src="js/smooth-scrollbar.js"></script>
<script src="js/admin.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const searchInput = document.querySelector('.main__title-form input[type="text"]');
        const searchButton = document.querySelector('.main__title-form button');
        const catalogBody = document.querySelector('.catalog__table tbody');
        const paginator = document.querySelector('.paginator');
        const directorsCount = document.querySelector('.main__title-stat');

        let currentPage = 1;
        let limit = 2;

        // Hàm gửi yêu cầu API và cập nhật bảng diễn viên
        function fetchDirectors(keyword = '', page = 1) {
            const url = `/api/v1/director?keyword=${encodeURIComponent(keyword)}&page=${page}&limit=${limit}`;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    // Cập nhật bảng diễn viên
                    catalogBody.innerHTML = '';
                    if (data.directors.length > 0) {
                        data.directors.forEach(director => {
                            catalogBody.innerHTML += `
                            <tr>
                                <td><div class="catalog__text">${director.id}</div></td>
                                <td><div class="catalog__text">${director.name}</div></td>
                                <td><div class="catalog__text">${director.year}</div></td>
                                <td>
                                    <div class="catalog__btns">
                                        <button type="button" class="catalog__btn catalog__btn--edit" data-id="${director.id}">
                                            <i class="ti ti-edit"></i>
                                        </button>
                                        <button type="button" class="catalog__btn catalog__btn--delete" data-id="${director.id}">
                                            <i class="ti ti-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        `;
                        });
                    } else {
                        catalogBody.innerHTML = '<tr><td colspan="4">No directors found</td></tr>';
                    }

                    // Cập nhật tổng số diễn viên
                    directorsCount.innerText = `${data.total} Total`;
                    // Cập nhật giao diện phân trang
                    updatePaginator(data.page, data.limit, data.total);
                })
                .catch(error => {
                    console.error('Error fetching directors:', error);
                });
        }

        // Hàm cập nhật giao diện phân trang
        function updatePaginator(page, limit, total) {
            paginator.innerHTML = '';
            const totalPages = Math.ceil(total / limit);

            if (page > 1) {
                paginator.innerHTML += `<li class="paginator__item paginator__item--prev"><a href="#" data-page="${page - 1}"><i class="ti ti-chevron-left"></i></a></li>`;
            }

            for (let i = 1; i <= totalPages; i++) {
                paginator.innerHTML += `<li class="paginator__item ${i === page ? 'paginator__item--active' : ''}"><a href="#" data-page="${i}">${i}</a></li>`;
            }

            if (page < totalPages) {
                paginator.innerHTML += `<li class="paginator__item paginator__item--next"><a href="#" data-page="${page + 1}"><i class="ti ti-chevron-right"></i></a></li>`;
            }

            // Gọi lại sự kiện phân trang sau khi tạo phân trang mới
            setPaginatorClickEvents();
        }

        // Hàm thêm sự kiện cho phân trang
        function setPaginatorClickEvents() {
            const pageLinks = paginator.querySelectorAll('a');

            pageLinks.forEach(link => {
                link.addEventListener('click', function (e) {
                    e.preventDefault();
                    const page = parseInt(link.getAttribute('data-page'));
                    if (!isNaN(page)) {
                        currentPage = page;
                        const keyword = searchInput.value.trim();
                        fetchDirectors(keyword, currentPage);
                    }
                });
            });
        }

        // Lắng nghe sự kiện tìm kiếm
        searchButton.addEventListener('click', function () {
            const keyword = searchInput.value.trim();
            currentPage = 1; // Khi tìm kiếm mới, đặt lại trang về 1
            fetchDirectors(keyword, currentPage);
        });

        // Lắng nghe sự kiện cho nút Edit
        catalogBody.addEventListener('click', function (e) {
            if (e.target.closest('.catalog__btn--edit')) {
                const directorId = e.target.closest('.catalog__btn').getAttribute('data-id');
                window.location.href = `http://localhost:8080/admin/edit-director?directorId=${directorId}`;
            }
        });

        // Lắng nghe sự kiện cho nút Delete
        catalogBody.addEventListener('click', function (e) {
            if (e.target.closest('.catalog__btn--delete')) {
                const directorId = e.target.closest('.catalog__btn').getAttribute('data-id');
                const token = localStorage.getItem('token'); // Thay thế với token thực tế của bạn
                if (confirm('Are you sure you want to delete this director?')) {
                    fetch(`/api/v1/director/${directorId}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    })
                        .then(response => {
                            if (response.ok) {
                                alert('director deleted successfully');
                                fetchDirectors(); // Cập nhật lại danh sách diễn viên
                            } else {
                                alert('Failed to delete director');
                            }
                        })
                        .catch(error => {
                            console.error('Error deleting director:', error);
                        });
                }
            }
        });

        // Gọi hàm lần đầu khi trang load
        fetchDirectors();
    });
</script>


</body>

</html>