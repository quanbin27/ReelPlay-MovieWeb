<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<!-- CSS -->
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="css/slimselect.css">
	<link rel="stylesheet" href="css/admin.css">
	<script src="../js/logout.js"></script>
	<!-- Icon font -->
	<link rel="stylesheet" href="webfont/tabler-icons.min.css">

	<!-- Favicons -->
	<link rel="icon" type="image/png" href="icon/favicon-32x32.png" sizes="32x32">
	<link rel="apple-touch-icon" href="icon/favicon-32x32.png">

	<meta name="description" content="Online Movies, TV Shows & Cinema HTML Template">
	<meta name="keywords" content="">
	<meta name="author" content="Dmitry Volkov">
	<title>ReelPlay– Online Movies, TV Shows & Cinema </title>
</head>

<body>
<!-- header -->
<header class="header">
	<div class="header__content">
		<!-- header logo -->
		<a href="index.html" class="header__logo">
			<img src="img/logo.svg" alt="">
		</a>
		<!-- end header logo -->

		<!-- header menu btn -->
		<button class="header__btn" type="button">
			<span></span>
			<span></span>
			<span></span>
		</button>
		<!-- end header menu btn -->
	</div>
</header>
<!-- end header -->

<!-- sidebar -->
<div class="sidebar">
	<!-- sidebar logo -->
	<a href="index.html" class="sidebar__logo">
		<img src="img/logo.svg" alt="">
	</a>
	<!-- end sidebar logo -->

	<!-- sidebar user -->
	<div class="sidebar__user">
		<div class="sidebar__user-img">
			<img src="img/user.svg" alt="">
		</div>

		<div class="sidebar__user-title">
			<span>Admin</span>
		</div>

		<button class="sidebar__user-btn" type="button" onclick="logout()">
			<i class="ti ti-logout"></i>
		</button>
	</div>
	<!-- end sidebar user -->

	<!-- sidebar nav -->
	<div class="sidebar__nav-wrap">
		<ul class="sidebar__nav">
			<li class="sidebar__nav-item">
				<a href="/admin/index" class="sidebar__nav-link"><i class="ti ti-layout-grid"></i> <span>Dashboard</span></a>
			</li>

			<li class="sidebar__nav-item">
				<a href="/admin/movie" class="sidebar__nav-link sidebar__nav-link--active"><i class="ti ti-movie"></i> <span>Movies</span></a>
			</li>

			<li class="sidebar__nav-item">
				<a href="/admin/user" class="sidebar__nav-link"><i class="ti ti-users"></i> <span>Users</span></a>
			</li>

			<li class="sidebar__nav-item">
				<a href="/admin/actor" class="sidebar__nav-link"><i class="ti ti-users-minus"></i> <span>Actors</span></a>
			</li>

			<li class="sidebar__nav-item">
				<a href="/admin/director" class="sidebar__nav-link"><i class="ti ti-users-minus"></i> <span>Directors</span></a>
			</li>
			<li class="sidebar__nav-item">
				<a href="/admin/episode" class="sidebar__nav-link"><i class="ti ti-badge-hd"></i> <span>Episodes</span></a>
			</li>


			<!-- end dropdown -->

			<li class="sidebar__nav-item">
				<a href="/index" class="sidebar__nav-link"><i class="ti ti-arrow-left"></i> <span>Back to ReelPlay</span></a>
			</li>
		</ul>
	</div>
	<!-- end sidebar nav -->

	<!-- sidebar copyright -->
	<!-- end sidebar copyright -->
</div>
	<!-- end sidebar -->

	<!-- main content -->
	<main class="main">
		<div class="container-fluid">
			<div class="row">
				<!-- main title -->
				<div class="col-12">
					<div class="main__title">
						<h2>Add new movie</h2>
					</div>
				</div>
				<!-- end main title -->

				<!-- form -->
				<div class="col-12">
					<form action="#" class="sign__form sign__form--add" id="formadd">
						<div class="row">
							<div class="col-12 col-xl-7">
								<div class="row">
									<div class="col-12">
										<div class="sign__group">
											<input type="text" class="sign__input" placeholder="Title" required>
										</div>
									</div>

									<div class="col-12">
										<div class="sign__group">
											<textarea id="text" name="text" class="sign__textarea" placeholder="Description"></textarea>
										</div>
									</div>

									<div class="col-12 ">
										<div class="sign__group">

											<div class="sign__group">
												<input type="text" class="sign__input" placeholder="Link to the trailer">
											</div>
										</div>
									</div>

									<div class="col-12 ">
										<div class="sign__group">
											<input type="text" class="sign__input" placeholder="Link to the background ">
										</div>
									</div>
								</div>
							</div>

							<div class="col-12 col-xl-5">
								<div class="row">
									<div class="col-12 ">
										<div class="sign__group">
											<div class="sign__group">
												<input type="text" class="sign__input" placeholder="Language">
											</div>
										</div>
									</div>
									<div class="col-12 col-md-6">
										<div class="sign__group">
											<div class="sign__group">
												<input type="text" class="sign__input" placeholder="Number of Episodes">
											</div>
										</div>
									</div>
									<div class="col-12 col-md-6">
										<div class="sign__group">
											<div class="sign__group">
												<input type="text" class="sign__input" placeholder="Average time per episode">
											</div>
										</div>
									</div>


									<div class="col-12">
										<div class="sign__group">
											<select class="sign__selectjs" id="sign__genre" multiple  >
												<option value="1">Action</option>
												<option value="2">Adventure</option>
												<option value="3">Animation</option>
												<option value="4">Biography</option>
												<option value="5">Comedy</option>
												<option value="6">Crime</option>
												<option value="7">Drama</option>
												<option value="8">Fantasy</option>
												<option value="9">History</option>
												<option value="10">Horror</option>
												<option value="11">Music</option>
												<option value="12">Mystery</option>
												<option value="13">Romance</option>
												<option value="14">Sci-Fi</option>
												<option value="15">Sport</option>
												<option value="16">Thriller</option>
												<option value="17">War</option>

											</select>
										</div>
									</div>

									<div class="col-12 ">
										<div class="sign__group">
											<input type="text" class="sign__input" placeholder="Release year" required>
										</div>
									</div>

									<div class="col-12">
										<div class="sign__group">
											<select class="sign__selectjs" id="sign__country" >
												<option value="1">USA</option>
												<option value="2">United Kingdom</option>
												<option value="3">South Korea</option>
												<option value="4">China</option>
												<option value="5">Japan</option>
												<option value="6">India</option>
												<option value="7">France</option>
												<option value="8">Germany</option>
												<option value="9">Turkey</option>
												<option value="10">Spain</option>
												<option value="11">Canada</option>
												<option value="12">Australia</option>
												<option value="13">Russia</option>
												<option value="14">Brazil</option>
												<option value="15">Italy</option>
												<option value="16">Philippines</option>
												<option value="17">Netherlands</option>
												<option value="18">Thailand</option>
												<option value="19">Hong Kong</option>
												<option value="20">Mexico</option>
												<option value="21">Denmark</option>
												<option value="22">Portugal</option>
												<option value="23">Poland</option>
												<option value="24">Norway</option>
												<option value="25">Taiwan</option>
												<option value="26">Ukraine</option>
												<option value="27">Other country</option>

											</select>
										</div>
									</div>
								</div>
							</div>

							<div class="col-12 col-md-6 col-xl-5">
								<div class="sign__group">
									<select class="sign__selectjs" id="sign__directors"  multiple>


									</select>
								</div>
							</div>

							<div class="col-12 col-md-6 col-xl-7">
								<div class="sign__group">
									<select class="sign__selectjs" id="sign__actor" multiple>

									</select>
								</div>
							</div>

							<div class="col-12">
								<div class="sign__group">
									<button type="button" class="sign__btn sign__btn--small" id="predict__btn"><span>Predict Rate</span></button>
									<div class="sign__group">
										<input type="text" class="sign__input" id="predictRateOutput" placeholder="Predict Rate" >
									</div>
									<label class="sign__label"> Recommend:</label>
									<ul class="sign__radio">
										<li>
											<input id="type1" type="radio" name="type">
											<label for="type1">Yes</label>
										</li>
										<li>
											<input id="type2" type="radio" name="type" >
											<label for="type2">No</label>
										</li>
									</ul>
								</div>
							</div>



							<div class="col-12">
								<button type="submit" class="sign__btn sign__btn--small" id="publish"><span>Publish</span></button>
							</div>
						</div>
					</form>
				</div>
				<!-- end form -->
			</div>
		</div>
	</main>
	<!-- end main content -->

	<!-- JS -->
	<script src="js/bootstrap.bundle.min.js"></script>
	<script src="js/slimselect.min.js"></script>
	<script src="js/smooth-scrollbar.js"></script>
	<script src="js/admin.js"></script>
	<script>
			var select1=new SlimSelect({
				select: '#sign__directors',
				settings: {
					placeholderText: 'Select Directors',
				},
				data: [],
			})
			var select2=new SlimSelect({
				select: '#sign__actor',
				settings: {
					placeholderText: 'Select Actors',
				},
				data: [],
			})







		document.addEventListener('DOMContentLoaded', function () {
			// Khởi tạo SlimSelect với options rỗng trước


			// Sau đó gọi API để lấy danh sách đạo diễn
			fetch('http://localhost:8080/api/v1/directors')
					.then(response => response.json())
					.then(data => {
						// Chuyển đổi dữ liệu thành định dạng mảng đối tượng
						const directorsData = data.map(director => ({
							text: director.name+" "+director.year.toString(),
							value: director.id
						}));

						console.log('Directors Data:', directorsData);

						// Cập nhật data cho SlimSelect instance đã tạo
						select1.setData(directorsData);
					})
					.catch(error => console.error('Error fetching directors:', error));
			fetch('http://localhost:8080/api/v1/actors')
					.then(response => response.json())
					.then(data => {
						// Chuyển đổi dữ liệu thành định dạng mảng đối tượng
						const actorsData = data.map(actor => ({
							text: actor.name+" "+actor.year.toString(),
							value: actor.id
						}));


						// Cập nhật data cho SlimSelect instance đã tạo
						select2.setData(actorsData);
					})
					.catch(error => console.error('Error fetching directors:', error));

		});



	</script>
<script>
	document.addEventListener('DOMContentLoaded', function () {
		// Xử lý sự kiện khi người dùng nhấn nút "Publish"
		document.querySelector('#formadd').addEventListener('submit', function (e) {
			// Thu thập dữ liệu từ các trường trong form
			e.preventDefault();
			const name = document.querySelector('input[placeholder="Title"]').value;
			const description = document.querySelector('#text').value;
			const trailer = document.querySelector('input[placeholder="Link to the trailer"]').value;
			const thumbnail = document.querySelector('input[placeholder="Link to the background "]').value;
			const language = document.querySelector('input[placeholder="Language"]').value;
			const year = parseInt(document.querySelector('input[placeholder="Release year"]').value);
			const predictRate = parseFloat(document.querySelector('input[placeholder="Predict Rate"]').value);
			const isRecommended = document.querySelector('#type1').checked;

			// Lấy giá trị từ select cho country, genre, actor và director
			const countryId = parseInt(document.querySelector('#sign__country').value);
			const categoryIds = Array.from(document.querySelector('#sign__genre').selectedOptions).map(option => parseInt(option.value));
			const actorIds = Array.from(document.querySelector('#sign__actor').selectedOptions).map(option => parseInt(option.value));
			const directorIds = Array.from(document.querySelector('#sign__directors').selectedOptions).map(option => parseInt(option.value));

			// Chuẩn bị dữ liệu để gửi
			const movieData = {
				name,
				year,
				description,
				language,
				country_id: countryId,
				thumbnail,
				trailer,
				predict_rate: predictRate,
				is_recommended: isRecommended,
				category_ids: categoryIds,
				actor_ids: actorIds,
				director_ids: directorIds
			};

			// Lấy token từ localStorage
			const token = localStorage.getItem('token');
			console.log("da lay token",token);
			// Gửi yêu cầu POST tới API
			fetch('http://localhost:8080/api/v1/movie', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
					'Authorization': `Bearer ${token}`
				},
				body: JSON.stringify(movieData)
			})
					.then(response => {
						if (!response.ok) {
							console.log("loi roi");
							throw new Error('Failed to add movie');
						}
						return response.json();
					})
					.then(data => {
						alert('Movie added successfully!');
						console.log(data);
					})
					.catch(error => {
						console.error('Error:', error);
						alert('An error occurred while adding the movie.');
					});
		});
	});
	document.querySelector("#predict__btn").addEventListener("click", async () => {
		// Collecting data
		const nationId = parseInt(document.getElementById("sign__country").value);
		const directorElements = document.querySelector("#sign__directors").selectedOptions;
		const directors = Array.from(directorElements).map(option => parseInt(option.value));
		const releasedYear = parseInt(document.querySelector('input[placeholder="Release year"]').value);
		const numofeps = parseInt(document.querySelector('input[placeholder="Number of Episodes"]').value);
		const epLength = parseInt(document.querySelector('input[placeholder="Average time per episode"]').value);

		// Collect up to three genres (or fewer if not selected)
		const genreElements = document.querySelector("#sign__genre").selectedOptions;
		const genres = Array.from(genreElements).slice(0, 3).map(option => parseInt(option.value));

		// Set genres, defaulting to null if not enough are selected
		const genre1 = genres[0] || 0;
		const genre2 = genres[1] || 0;
		const genre3 = genres[2] || 0;

		// Variables to calculate the average predicted rating
		let totalRating = 0;
		let count = 0;

		// Loop through each director and send a POST request
		for (const directorId of directors) {
			// JSON data to send
			const data = {
				nationId,
				directorId,
				releasedYear,
				numofeps,
				epLength,
				genre1,
				genre2,
				genre3
			};

			try {
				// Sending POST request
				const response = await fetch("http://localhost:5000/predict", {
					method: "POST",
					headers: {
						"Content-Type": "application/json"
					},
					body: JSON.stringify(data)
				});

				// Parsing response and adding to totalRating
				const result = await response.json();
				if (result.predicted_rating !== undefined) {
					totalRating += result.predicted_rating;
					count++;
				}
			} catch (error) {
				console.error("Error:", error);
			}
		}

		// Calculate and display the average rating
		const averageRating = count > 0 ? (totalRating / count).toFixed(2) : "N/A";
		document.getElementById("predictRateOutput").value = averageRating;
		if (averageRating !== "N/A") {
			document.getElementById("type1").checked = averageRating > 5;
			document.getElementById("type2").checked = averageRating <= 5;
		}
	});




</script>

</body>

<!-- Mirrored from hotflix.volkovdesign.com/admin/add-item.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 01 Oct 2024 14:35:46 GMT -->
</html>